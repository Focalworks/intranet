var Comments=angular.module("Comments",[]);Comments.factory("commentsService",["$http","$rootScope",function(a,b){var c=[];return{fetchComments:function(d,e){return a({headers:{"Content-Type":"application/x-www-form-urlencoded"},url:base_url+"comment/get",method:"POST",data:$.param({nid:d,section:e})}).success(function(a){c=a?a.comments:{},b.$broadcast("handleProjectsBroadcast",c)})},saveComments:function(d,e,f,g,h){var i={};return i.section=d,i.comment=e,a({headers:{"Content-Type":"application/x-www-form-urlencoded"},url:base_url+"comment/save",method:"POST",data:$.param({data:JSON.stringify(i),nid:f,parent_cid:g,op:h})}).success(function(a){c=a,b.$broadcast("handleProjectsBroadcast",c)})},removeComments:function(b){return a({headers:{"Content-Type":"application/x-www-form-urlencoded"},url:base_url+"comment/delete",method:"POST",data:$.param({data:JSON.stringify(b)})}).success(function(){})}}}]),Comments.directive("comment",function(){return{restrict:"E",scope:{section:"@",nid:"="},replace:!0,templateUrl:base_url+"comment/comment-wrapper-template",link:function(){},controller:function(a,b){a.showPopup=!1,a.commentPosted=!1;var c=a.nid,d=a.section;b.fetchComments(c,d).then(function(b){a.all_comments=b.data?b.data:{}}),a.showPopup=!0,a.commentPosted=!1,a.new_post_comment=function(c){b.saveComments(a.section,c,a.nid,0).then(function(b){a.all_comments.push(b.data),a.new_comment_message=""})}}}}),Comments.directive("commentTree",function(){return{restrict:"E",replace:!0,scope:{collection:"=",nid:"=",section:"="},template:'<ul class="comments-wrapper"><comment_item ng-repeat="comment in collection" comment="comment" nid="nid" section="section"></comment_item></ul>'}}),Comments.directive("commentItem",["$compile","commentsService",function(a,b){return{restrict:"E",replace:!0,scope:{comment:"=",nid:"=",section:"="},templateUrl:base_url+"comment/comment-template",link:function(c,d){if(angular.isArray(c.comment.children)){var e=angular.element("<comment_tree collection='comment.children' nid='nid' section='section'></comment_tree>");d.append(e),a(e)(c)}c.hideReply={},c.editComment={},c.deleted={},c.deleted[c.comment.cid]=!1,c.hideReply[c.comment.cid]=!0,c.editComment[c.comment.cid]=!0,c.post_comment=function(e,f){"Edit"==f?b.saveComments(c.section,e.comment,c.nid,e.cid,f).then(function(){c.editComment[c.comment.cid]=!0}):c.comment_message&&b.saveComments(c.section,c.comment_message,c.nid,e.cid).then(function(b){if(void 0==c.comment.children){c.comment.children=[],c.comment.children.push(b.data);var e=angular.element("<comment_tree collection='comment.children' nid='nid' section='section'></comment_tree>");d.append(e),a(e)(c)}else c.comment.children.push(b.data);c.comment_message="",c.hideReply[c.comment.cid]=!0})},c.delete_comment=function(a){b.removeComments(a).then(function(){c.comment={},c.deleted={},c.deleted[c.comment.cid]=!0,c.hideReply[c.comment.cid]=!0,c.editComment[c.comment.cid]=!0})}}}}]);
var articleApp=angular.module("articleApp",["Comments"]);articleApp.config(function(a){a.startSymbol("(["),a.endSymbol("])")}),articleApp.controller("mainCntrl",function(){});